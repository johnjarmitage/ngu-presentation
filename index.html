<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>The importance of ice sheet growth and retreat on magmatism and mantle CO<sup>2</sup> flux</title>

		<link rel="stylesheet" href="reveal.js/css/reveal.css">
		<link rel="stylesheet" href="reveal.js/css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'reveal.js/text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );           
		</script>
        
        <!-- Plotly -->
        <script src="plotly.js/plotly-latest.min.js">
        </script>
        
        <!--- math.js -->
        <script src="math.js/math.min.js">
        </script>
        
        <!--- iframe style -->
        <style>
            .p_iframe iframe {
                width:100%;
                height:576px;
            }
        </style>
	</head>
    
    <!-- presentation starts here -->
    
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h3>The importance of ice sheet growth and retreat on magmatism and mantle CO<sub>2</sub> flux</h3>
					<p>John Armitage</p>
                    <small>Kenni Petersen, Dave Ferguson, and Tim Creyts</small>
				</section>
                
                <!-- some background on the subject -->
                
				<section>
					<section data-background='figures/title-page.jpg'>
						<h3>Can deglaciation impact mantle processus? </h3>
                        <p> Iceland </p>
					</section>
					<section>
                        <div class="p_iframe">
                        <iframe frameborder="0" seamless='seamless' scrolling=no src="map-lgm.html"></iframe>
                        </div>
                    </section>
                    <section>
                        <div class="p_iframe">
                        <iframe frameborder="0" seamless='seamless' scrolling=no src="map-wvz.html"></iframe>
                        </div>
                    </section>
                    
                    <section>
						<small> In the latest Pleistocene the Icelandic ice sheet rapidly melted.</small>
                        <small> The result was an observed increase in volcanism (e.g. Sinton et al., 2005).</small>
						<img width="600" src='figures/sinton.png' style="background:none; border:none; box-shadow:none;" >
					</section>
                </section>
                
                <!-- making an ice sheet history -->
                
                <section>
                    <section>
                        <h3> An ice sheet thickness history </h3>
                    </section>
                    
                    <section data-state="NGRIP-is-visible">
                        <div id="NGRIP"></div>
                    </section>
                    <section>
                        <p> We find that the ice sheet thickness, oxygen isotope record, and relative sea level are correlated.</p>
                        
                    </section>
                    <section data-state="ice-thickness-is-visible">
                        <div id="ice-thickness"></div>
                    </section>  
                </section>
                
                <!-- the observed association with melt composition change and ice sheet history -->
                
                <section>
                    <section>
                        <h3> An association between lava composition and deglaciation? </h3>
                    </section>
                    <section data-state="Nb-raw-is-visible">
                        <p> Increase in volcansim recorded as a reduction in Nb composition (Gee et al., 1998; Eason et al., 2015).</p>
                        <div id="Nb-raw"></div>
                    </section>
                    <section data-state="Nb-corr-is-visible">
                        <p> Correlation coefficient ~ 0.6 [Gaussian smoothing in R].</p>
                        <div id="Nb-corr"></div>
                    </section>
                    <section data-state="random-corr-is-visible">
                        <p> Correlation coefficient ~ 0.6 [Gaussian smoothing in R].</p>
                        <div id="random-corr"></div>
                    </section>
                </section>
                
                <!-- testing the association -->
                
                <section>
                    <section>
                        <h3> Testing the association... </h3>
                    </section>
                    <section>
                        <table>
                            <thead><tr>
                                <th>Ice on top</th>
                                <th>Ice gone</th>
                                </tr>
                            </thead>
                            <tbody><tr>
                                <td>
                                    <img width="500" src="figures/slide3_a.png" style="background:none; border:none; box-shadow:none;">
                                </td>
                                <td>
                                    <img width="500" src="figures/slide3_b.png" style="background:none; border:none; box-shadow:none;">
                                </td>
                                </tr>
                            </tbody>
                        </table>
                    </section>
                    
                    <!-- step 1 to solve the coupled equations-->
                    
                    <section>
                        <p> Step 1: Solve for melt production and transport </p>
                        <ul>
                            <li> Calculate the transport of melt through a porous medium. </li>
                            <li> We need a relationship between melt porosity and permeability. </li>
                            <li> This allows a continuity equation to be written. </li>
                        </ul>
                    </section>
                    <section>
                        <small> Mean velocity: $$ v = (1-\phi) v_{s} + \phi v_{l} $$ </small><br><br>
                        <small> Modified Darcy's law to relate average and melt velocity: $$ v_{l} - v = \left(1 - \phi\right)\frac{k}{\phi \eta_{l}} \Delta\rho g $$</small><br><br>
                        <small> Permeability closure equation: $$ k = k_{0}\phi^{3} $$</small><br><br>
                        <small> Conservation of mass (melt): $$ -m + \partial_{t}\phi + v\partial_{z}\phi + \frac{k_{0}\Delta\rho g}{\eta_{l}} \phi^{2}\left(1-\frac{4}{3}\phi\right)\partial_{z}\phi = 0$$</small>                    
                    </section>
                    <section data-background-color="#000000">
                        <div>
                            <video width='30%' data-autoplay loop controls='true' src='videos/temp.mp4' type='video/mp4'></video>
                            <video width='30%' data-autoplay loop controls='true' src='videos/poro.mp4' type='video/mp4'></video>
                        </div>
                        <small> That non-linear equation solved using finite elements (FEniCS + Python) </small>
                    </section>
                    
                    <!-- step 2 to solve the coupled equations-->
                    
                    <section>
                        <p> Step 2: Solve for displacement due to deglaciation </p>
                        <ul>
                            <li> We perturb the mantle upwelling by displacement due to deglaciation. </li>
                            <li> We need to calculate how the displacement due to the ice load decreases with depth. </li>
                            <li> We need to calculate how the displacement due to the ice load changes with time. </li>
                        </ul>
                    </section>
                    <section>
                        <small> Mean velocity: $$ v = (1-\phi) v_{s} + \phi v_{l} = u + \partial_{t}w $$ </small><br><br>
                        <small>The displacement, $w$, due to the ice load diminishes with depth (England et al., 1983): $$ w = w_{0}exp\left(-\frac{\sqrt{3}\pi}{\lambda}z\right) $$ </small><br><br>
                        <small>The surface displacement is from the solution to plate flexure: $$ N \partial_{x}^{4}\left(\partial_{t}w_{0}\right) = \frac{P_{ice}}{\tau_{e}} $$ </small><br><br>
                        <small>[$\lambda$ is the glacier wavelength, $N$ is elastic fexural rigidity, $P_{ice}$ is the ice sheet load, $\tau_{e}$ is the viscoelastic decay time]</small>
                    </section>
                </section>
                
                <!-- stepwise deglaciation -->
                
                <section>
                    <section>
                        <h3> Model response to an "on-off" ice sheet</h3>
                    </section>
                    <section>
                        <div>
                            <video width='60%' data-autoplay controls='true' src='videos/1e5.mp4' type='video/mp4'></video>
                        </div>
                        <small> Melt percolation solved using a finite volume TVD scheme (Matlab) </small>
                    </section>
                    <section data-state="modelStep7-is-visible">
                        <small> Prediction of eruption rate, $\phi v_{l}$ when $k_{0} = 10^{-7}$ </small>
                        <div id="modelStep7"></div>
                    </section>
                    <section data-state="modelStep5-is-visible">
                        <small> Prediction of eruption rate, $\phi v_{l}$ when $k_{0} = 10^{-5}$ </small>
                        <div id="modelStep5"></div>
                    </section>
                </section>
                
                <!-- low seismic velocities beneath Iceland -->
                
                <section>
                    <section>
                        <h3> What can we learn from the mantle structure?</h3>
                    </section>
                    <section data-background="white">
                        <small>Cross section of seismic velocity (Allen et al., 2001) </small>
                        <img width="80%" src='figures/allenIceland1.png' style="background:none; border:none; box-shadow:none;" >
                    </section>
                    <section data-background="white">
                        <small>Cross section of seismic velocity (Allen et al., 2001) </small>
                        <img width="80%" src='figures/allenIceland2.png' style="background:none; border:none; box-shadow:none;" >
                    </section>
                    <section data-state="Vs-depth-is-visible">
                        <small> Compare predicted $\phi$ with inverted $V_{S}$ </small>
                        <div id="Vs-depth"></div>
                    </section>
                    
                </section>
                
                <!-- ice sheet histories -->
                
                <section>
                    <section>
                        <h3> Force the model with a 120ka ice sheet history</h3>
                    </section>
                    <section data-state="120ka-erupt-is-visible">
                        <div id="120ka-erupt"></div>
                    </section>
                    <section data-state="120ka-CO2-is-visible">
                        <div id="120ka-CO2"></div>
                    </section>
                    <section>
                        <p> (1) The model is very sensitive to the rate of deglaciation.</p>
                        <p> (2) The build up of ice impacts the subsequent deglaciation melting.</p>
                    </section>
                    <section>
                        <h3> Focus on the last 40ka</h3>
                    </section>
                    <section>
						<p> In the latest Pleistocene the Icelandic ice sheet rapidly melted.</p>
                        <p> The result was an observed increase in volcanism (e.g. Maclennan et al. 2002).</p>
						<img width="900" src='figures/slide1.png' style="background:none; border:none; box-shadow:none;" >
					</section>
                    <section data-state="40ka-erupt-is-visible">
                        <div id="40ka-erupt"></div>
                    </section>
                    <section data-state="40ka-Nb-is-visible">
                        <div id="Nb-erupt"></div>
                    </section>
                    <section data-state="40ka-CO2-is-visible">
                        <div id="CO2-erupt"></div>
                    </section>
                    

                    <section>
                        <h3> So deglaciation does most likely impact the deep: </h3>
                        <p> (1) Melt retention is however low to match shallow $V_{S}$ anomaly. </p>
                        <p> (2) Melt production however must increase to match Nb composition. </p>
                    </section>
                    
				</section>
                
                
			</div>
		</div>

		<script src="reveal.js/lib/js/head.min.js"></script>
		<script src="reveal.js/js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
                
                width: "100%",
                height: "100%",
                
                // to stop plots being half way down the slide
                // center: false, 
                
                math: {
                    mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
                    //mathjax: 'MathJax/MathJax.js',
                    config: 'TeX-AMS_HTML-full' // See http://docs.mathjax.org/en/latest/config-files.html
                },
				dependencies: [
					{ src: 'reveal.js/plugin/markdown/marked.js' },
					{ src: 'reveal.js/plugin/markdown/markdown.js' },
					{ src: 'reveal.js/plugin/notes/notes.js', async: true },
					{ src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'reveal.js/plugin/math/math.js', async: true }
				]
			});
        </script>
        
        <!-- plotly plots -->
        
        <!-- plot of NGRIP and sea level  -->
        
        <script>
            Reveal.addEventListener('NGRIP-is-visible', function() {
                Plotly.d3.csv("data/NGRIP.csv", function(error1, data1) {
                    Plotly.d3.csv("data/lambeck-2014-sea-level.csv", function(error2, data2) { 
                        Plotly.d3.csv("data/patton.csv", function(error3, data3) {
                            var x1 = [], y1 = [], x2 = [], y2 = [], x3 = [], y3 = [];

                            for (var i=0; i<data1.length; i++) {
                                row = data1[i];
                                x1.push( row['time'] );
                                y1.push( row['deltaO'] );
                            }
                            for (var i=0; i<data2.length; i++) {
                                row = data2[i];
                                x2.push( row['age'] );
                                y2.push( row['sea level'] );
                            }
                            for (var i=0; i<data3.length; i++) {
                                row = data3[i];
                                x3.push( row['Age'] );
                                y3.push( row['Thickness'] );
                            }
                            
                            x1 = math.multiply(1000,x1)
                            x2 = math.multiply(1000,x2)
                            x3 = math.multiply(-1,x3)
                                                    
                            console.log('X1',x1, 'Y1',y1, 'X2',x2, 'Y2', y2);
                            makePlotly(x1, y1, x2, y2, x3, y3);
                        });
                    });
                });

                function makePlotly(x1, y1, x2, y2, x3, y3){
                    var plotDiv = document.getElementById("plot");
                    var trace1 = {
                        x: x1,
                        y: y1,
                        mode: 'lines',
                        name: 'NGRIP'
                    };
                    var trace2 = {
                        x: x2,
                        y: y2,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'R.S.L'
                    };
                    var trace3 = {
                        x: x3,
                        y: y3,
                        xaxis: 'x3',
                        yaxis: 'y3',
                        mode: 'lines',
                        name: 'Patton'
                    };
                    var data = [trace1, trace2, trace3];
                    var layout = {
                        showlegend: false,
                        grid: {rows: 3, columns: 1, pattern: 'independent'},
                        title: {text:'Correlation between NGRIP, R.S.L., and Ice Sheet Thickness'},
                        xaxis1: {range: [0, 35000]},
                        yaxis1: {title: {text: 'NGRIP delta O'}},
                        xaxis2: {range: [0, 35000]},
                        yaxis2: {title: {text: 'R.S.L. (m)'}},
                        xaxis3: {title: {text: 'Time (yrs)'}, range: [0, 35000]},
                        yaxis3: {title: {text: 'Ice thickness (m)'}}
                    };

                    Plotly.newPlot('NGRIP', data, layout).then(Reveal.layout);
                };
            });
        </script>
                
        <!-- plot of ice sheet thickness  -->
        
        <script>
            Reveal.addEventListener('ice-thickness-is-visible', function() {
                Plotly.d3.csv("data/NGRIP.csv", function(error1, data1) {
                    Plotly.d3.csv("data/iceland.csv", function(error2, data2) {
                
                        var x1 = [], y11 = [], y12 = [], x2 = [], y21 = [];

                        for (var i=0; i<data1.length; i++) {
                            row = data1[i];
                            x2.push( row['time'] );
                            y21.push( row['deltaO'] );
                        }   

                        for (var i=0; i<data2.length; i++) {
                            row = data2[i];
                            x1.push( row['time'] );
                            y11.push( row['ice5g'] );
                            y12.push( row['pico'] );
                        }
                        
                        x2 = math.multiply(1000,x2)
                        
                        console.log('X',x1, 'Y1',y11, 'Y2', y12);
                        makePlotly(x1, y11, y12, x2, y21);
                    });
                });
                
                function makePlotly(x1, y11, y12, x2, y21){
                    var plotDiv = document.getElementById("plot");
                    var trace1 = {
                        x: x1,
                        y: y11,
                        mode: 'lines',
                        name: 'ICE5G'
                    };
                    var trace2 = {
                        x: x1,
                        y: y12,
                        mode: 'lines',
                        name: 'PC2'
                    };
                    var trace3 = {
                        x: x2,
                        y: y21,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'NGRIP'
                    };
                    var data = [trace1, trace2, trace3];
                    var layout = {
                        title: {text:'Iceland Ice Sheet for last 120 ka'},
                        grid: {rows: 2, columns: 1, pattern: 'independent'},
                        xaxis1: {range: [0, 120000]},
                        yaxis1: {title: {text: 'Thickness (km)'}},
                        xaxis2: {title: {text: 'Time (yrs)'}, range: [0, 120000]},
                        yaxis2: {title: {text: 'NGRIP'}}
                    };
                    
                    Plotly.newPlot('ice-thickness', data, layout).then(Reveal.layout);
                };
            });
        </script>  
        
        <!-- plot of Nb compostion and ice sheet history -->
        
        <script>
            Reveal.addEventListener('Nb-raw-is-visible', function() {
                Plotly.d3.csv("data/Nb_raw.csv", function(error1, data1) {
                    Plotly.d3.csv("data/Ice_raw.csv", function(error2, data2) { 
                        var x1 = [], y1 = [], x2 = [], y2 = [];

                        for (var i=0; i<data1.length; i++) {
                            row = data1[i];
                            x1.push( row['age'] );
                            y1.push( row['Nb'] );
                        }
                        for (var i=0; i<data2.length; i++) {
                            row = data2[i];
                            x2.push( row['age'] );
                            y2.push( row['Ice'] );
                        }
                        console.log('X1',x1, 'Y1',y1, 'X2',x2, 'Y2', y2);
                        makePlotly(x1, y1, x2, y2);
                    });
                });
            
                function makePlotly(x1, y1, x2, y2){
                    var plotDiv = document.getElementById("plot");
                    var trace1 = {
                        x: x1,
                        y: y1,
                        mode: 'markers',
                        type: 'scatter',
                        name: 'Nb composition'
                    };
                    var trace2 = {
                        x: x2,
                        y: y2,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'Ice Sheet'
                    };
                    var data = [trace1, trace2];
                    var layout = {
                        showlegend: false,
                        grid: {rows: 2, columns: 1, pattern: 'independent'},
                        title: {text:'Nb composition from Gee et al. (1998) and Eason et al. (2015)'},
                        xaxis1: {range: [0, 40]},
                        yaxis1: {title: {text: 'Nb (ppm)'}},
                        xaxis2: {title: {text: 'Time (kyrs)'}, range: [0, 40]},
                        yaxis2: {title: {text: 'Ice Thickness (km)'}}
                    };

                    Plotly.newPlot('Nb-raw', data, layout).then(Reveal.layout);
                };
            });
        </script>
        
        <!-- plot of correlation between Nb and ice thickness -->
        
        <script>
            Reveal.addEventListener('Nb-corr-is-visible', function() {
                Plotly.d3.csv("data/Nb_correlation.csv", processData);
                
                function processData(allRows) {
                    console.log(allRows);
                    var x = [], y11 = [], y12 = [], y13 = [];
                    var y21 = [], y22 = [], y23 = [];
                    
                    for (var i=0; i<allRows.length; i++) {
                        row = allRows[i];
                        x.push( row['age'] );
                        y11.push( row['Nbhat'] );
                        y12.push( row['Nbmin'] );
                        y13.push( row['Nbmax'] );
                        y21.push( row['Icehat'] );
                        y22.push( row['Icemin'] );
                        y23.push( row['Icemax'] );
                    }
                                        
                    console.log('X',x);
                    makePlotly(x, y11, y12, y13, y21, y22, y23);
                }
                
                function makePlotly(x, y11, y12, y13, y21, y22, y23){
                    var plotDiv = document.getElementById("plot");
                    var trace11 = {
                        x: x,
                        y: y11,
                        mode: 'lines',
                        name: 'Nb'
                    };
                    var trace12 = {
                        x: x,
                        y: y12,
                        mode: 'lines',
                        line: {dash: 'dashdot'},
                        name: 'Nb min'
                    };
                    var trace13 = {
                        x: x,
                        y: y13,
                        mode: 'lines',
                        line: {dash: 'dashdot'},
                        name: 'Nb max'
                    };
                    var trace21 = {
                        x: x,
                        y: y21,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'Ice Sheet'
                    };
                    var trace22 = {
                        x: x,
                        y: y22,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        line: {dash: 'dashdot'},
                        name: 'Ice min'
                    };
                    var trace23 = {
                        x: x,
                        y: y23,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        line: {dash: 'dashdot'},
                        name: 'Ice max'
                    };
                    var data = [trace11, trace12, trace13, trace21, trace22, trace23];
                    var layout = {
                        grid: {rows: 2, columns: 1, pattern: 'independent'},
                        title: {text:'Gaussian smoothing of trends'},
                        xaxis1: {range: [0, 40]},
                        yaxis1: {title: {text: 'Nb (ppm)'}},
                        xaxis2: {title: {text: 'Time (kyrs)'}, range: [0, 40]},
                        yaxis2: {title: {text: 'Ice Thickness (km)'}}
                    };
                
                    Plotly.newPlot('Nb-corr', data, layout).then(Reveal.layout);
                };
            });
        </script>
        
        <!-- plot of correlation between random scatters -->
        
        <script>
            Reveal.addEventListener('random-corr-is-visible', function() {
                Plotly.d3.csv("data/random_correlation.csv", processData);
                
                function processData(allRows) {
                    console.log(allRows);
                    var x = [], y11 = [], y12 = [], y13 = [];
                    var y21 = [], y22 = [], y23 = [];
                    
                    for (var i=0; i<allRows.length; i++) {
                        row = allRows[i];
                        x.push( row['age'] );
                        y11.push( row['Nb'] );
                        y12.push( row['Nbhat'] );
                        y21.push( row['Ice'] );
                        y22.push( row['Icehat'] );
                    }
                        
                    console.log('X',x);
                    makePlotly(x, y11, y12, y21, y22);
                }
                
                function makePlotly(x, y11, y12, y21, y22){
                    var plotDiv = document.getElementById("plot");
                    var trace11 = {
                        x: x,
                        y: y11,
                        mode:  'markers',
                        type: 'scatter',
                        name: 'Nb'
                    };
                    var trace12 = {
                        x: x,
                        y: y12,
                        mode: 'lines',
                        name: 'Nb hat'
                    };
                    var trace21 = {
                        x: x,
                        y: y21,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'markers',
                        type: 'scatter',
                        name: 'Ice Sheet'
                    };
                    var trace22 = {
                        x: x,
                        y: y22,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'Ice hat'
                    };
                    var data = [trace11, trace12, trace21, trace22];
                    var layout = {
                        grid: {rows: 1, columns: 2, pattern: 'independent'},
                        title: {text:'Smoothed random distributions'},
                        xaxis1: {title: {text: 'Time (kyrs)'}},
                        yaxis1: {title: {text: 'Nb (ppm)'}},
                        xaxis2: {title: {text: 'Time (kyrs)'}},
                        yaxis2: {title: {text: 'Ice Thickness (km)'}}
                    };
                
                    Plotly.newPlot('random-corr', data, layout).then(Reveal.layout);
                };
            });
        </script>
        
        <!-- step change in ice thickness, permeability coeff. 10^-7 -->
        
        <script>
            Reveal.addEventListener('modelStep7-is-visible', function() {
                Plotly.d3.csv("data/modelStep_1e-5.csv", processData);
                
                function processData(allRows) {
                    console.log(allRows);
                    var x = [], y1 = [], y2 = [];
                    
                    for (var i=0; i<allRows.length; i++) {
                        row = allRows[i];
                        x.push( row['time'] );
                        y1.push( row['ice_sheet'] );
                        y2.push( row['erupt_rate'] );
                    }
                        
                    console.log( 'X',x, 'Y1',y1, 'Y2', y2);
                    makePlotly( x, y1, y2);
                }
                
                function makePlotly( x, y1, y2){
                    var plotDiv = document.getElementById("plot");
                    var trace1 = {
                        x: x,
                        y: y1,
                        mode: 'lines',
                        name: 'Ice Sheet'
                    };
                    var trace2 = {
                        x: x,
                        y: y2,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'Eruption Rate'
                    };
                    var data = [trace1, trace2];
                    var layout = {
                        //autosize: false,
                        //width: 1000,
                        //height: 500,
                        grid: {rows: 2, columns: 1, pattern: 'independent'},
                        title: {text:'Model response to step change'},
                        xaxis1: {range: [0, 120]},
                        yaxis1: {title: {text: 'Ice Thickness (km)'}, range: [0, 2.5]},
                        xaxis2: {title: {text: 'Time (kyrs)'}, range: [0, 120]},
                        yaxis2: {title: {text: 'Eruption rate (km/Myr)'}}
                    };
                
                        Plotly.newPlot('modelStep7', data, layout).then(Reveal.layout);
                };
            });
            
        </script>
            
        <!-- step change in ice thickness, permeability coeff. 10^-7 -->
        
        <script>
            Reveal.addEventListener('modelStep5-is-visible', function() {
                Plotly.d3.csv("data/modelStep_1e-5.csv", processData);
                
                function processData(allRows) {
                    console.log(allRows);
                    var x = [], y1 = [], y2 = [];
                    
                    for (var i=0; i<allRows.length; i++) {
                        row = allRows[i];
                        x.push( row['time'] );
                        y1.push( row['ice_sheet'] );
                        y2.push( row['erupt_rate'] );
                    }
                        
                    console.log( 'X',x, 'Y1',y1, 'Y2', y2);
                    makePlotly( x, y1, y2);
                }
                
                function makePlotly( x, y1, y2){
                    var plotDiv = document.getElementById("plot");
                    var trace1 = {
                        x: x,
                        y: y1,
                        mode: 'lines',
                        name: 'Ice Sheet'
                    };
                    var trace2 = {
                        x: x,
                        y: y2,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'Eruption Rate'
                    };
                    var data = [trace1, trace2];
                    var layout = {
                        //autosize: false,
                        //width: 1000,
                        //height: 500,
                        grid: {rows: 2, columns: 1, pattern: 'independent'},
                        title: {text:'Model response to step change'},
                        xaxis1: {range: [0, 120]},
                        yaxis1: {title: {text: 'Ice Thickness (km)'}, range: [0, 2.5]},
                        xaxis2: {title: {text: 'Time (kyrs)'}, range: [0, 120]},
                        yaxis2: {title: {text: 'Eruption rate (km/Myr)'}}
                    };
                    
                    Plotly.newPlot('modelStep5', data, layout).then(Reveal.layout);
                };              
            });
        </script>
        
        <!-- depth, Vs, and phi -->
        
        <script>
            Reveal.addEventListener('Vs-depth-is-visible', function() {
                Plotly.d3.csv("data/Vs_1e-5.csv", function(error1, data1) {
                    Plotly.d3.csv("data/Vs_1e-7.csv", function(error2, data2) {
                        Plotly.d3.csv("data/Vs_obs.csv", function(error3, data3) {
                            var x1 = [], y11 = [], y12 = [], y13 = [];
                            var x2 = [], y21 = [], y22 = [], y23 = [];
                            var x3 = [], y31 = [], y32 = [];

                            for (var i=0; i<data1.length; i++) {
                                row = data1[i];
                                x1.push( row['depth'] );
                                y11.push( row['Vsana'] );
                                y12.push( row['Vsphi'] );
                                y13.push( row['phi'] );
                            }
                            for (var i=0; i<data2.length; i++) {
                                row = data2[i];
                                x2.push( row['depth'] );
                                y21.push( row['Vsana'] );
                                y22.push( row['Vsphi'] );
                                y23.push( row['phi'] );
                            }
                            for (var i=0; i<data3.length; i++) {
                                row = data3[i];
                                x3.push( row['depth'] );
                                y31.push( row['Vmin'] );
                                y32.push( row['Vmax'] );
                            }
                            makePlotly(x1, y11, y12, y13, x2, y21, y22, y23, x3, y31, y32);
                        });
                    }); 
                });
                    
                function makePlotly(x1, y11, y12, y13, x2, y21, y22, y23, x3, y31, y32){
                    var plotDiv = document.getElementById("plot");
                    var tracephi1 = {
                        x: y13,
                        y: x1,
                        mode: 'lines',
                        marker: {color: 'rgb(142, 124, 195)'},
                        name: 'Porosity, k=1e-5'
                    };
                    var tracephi2 = {
                        x: y23,
                        y: x2,
                        mode: 'lines',
                        marker: {color: 'rgb(255, 217, 102)'},
                        name: 'Porosity, k=1e-5'
                    };
                    var traceobsmin1 = {
                        x: y31,
                        y: x3,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        marker: {color: 'rgb(200, 200, 200)'},
                        name: 'Observation min.'
                    };
                    var traceobsmax1 = {
                        x: y32,
                        y: x3,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        marker: {color: 'rgb(150, 150, 150)'},
                        name: 'Observation max.'
                    };
                    var tracevana1 = {
                        x: y11,
                        y: x1,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        marker: {color: 'rgb(142, 124, 195)'},
                        line: {dash: 'dashdot'},
                        name: 'Vs, k=1e-5, no melt'
                    };
                    var tracevphi1 = {
                        x: y12,
                        y: x1,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        marker: {color: 'rgb(142, 124, 195)'},
                        mode: 'lines',
                        name: 'Vs, k=1e-5, melt'
                    };
                    var traceobsmin2 = {
                        x: y31,
                        y: x3,
                        xaxis: 'x3',
                        yaxis: 'y3',
                        mode: 'lines',
                        marker: {color: 'rgb(200, 200, 200)'},
                        name: 'Observation min.'
                    };
                    var traceobsmax2 = {
                        x: y32,
                        y: x3,
                        xaxis: 'x3',
                        yaxis: 'y3',
                        mode: 'lines',
                        marker: {color: 'rgb(150, 150, 150)'},
                        name: 'Observation max.'
                    };
                    var tracevana2 = {
                        x: y21,
                        y: x2,
                        xaxis: 'x3',
                        yaxis: 'y3',
                        mode: 'lines',
                        marker: {color: 'rgb(255, 217, 102)'},
                        line: {dash: 'dashdot'},
                        name: 'Vs, k=1e-5, no melt'
                    };
                    var tracevphi2 = {
                        x: y22,
                        y: x2,
                        xaxis: 'x3',
                        yaxis: 'y3',                 
                        mode: 'lines',
                        marker: {color: 'rgb(255, 217, 102)'},
                        name: 'Vs, k=1e-5, melt'
                    };

                    var data = [tracephi1, tracephi2, traceobsmin1, traceobsmax1, tracevana1, tracevphi1,
                                traceobsmin2, traceobsmax2, tracevana2, tracevphi2];
                    var layout = {
                        grid: {rows: 1, columns: 3, pattern: 'independent'},
                        title: {text:'Depth Profiles'},
                        xaxis1: {title: {text: 'Porosity'}, range: [0, 0.01]},
                        yaxis1: {title: {text: 'Depth (km)'}, range: [150, 30]},
                        xaxis2: {title: {text: 'Vs (km/s)'}, range: [3.6, 4.4]},
                        yaxis2: {title: {text: 'Depth (km)'}, range: [150, 30]},
                        xaxis3: {title: {text: 'Vs (km/s)'}, range: [3.6, 4.4]},
                        yaxis3: {title: {text: 'Depth (km)'}, range: [150, 30]}
                    };
                    
                    Plotly.newPlot('Vs-depth', data, layout).then(Reveal.layout);
                };              
            });
        </script>
        
        <!-- 120 ka ICE5G eruption rates -->
        
        <script>
            Reveal.addEventListener('120ka-erupt-is-visible', function() {
                Plotly.d3.csv("data/model_M1.csv", function(error1, data1) {
                    Plotly.d3.csv("data/model_M1b.csv", function(error2, data2) { 
                        var x1 = [], y11 = [], y12 = [], x2 = [], y21 = [];

                        for (var i=0; i<data1.length; i++) {
                            row = data1[i];
                            x1.push( row['time'] );
                            y11.push( row['ice_sheet'] );
                            y12.push( row['erupt_rate'] );
                        }
                        for (var i=0; i<data2.length; i++) {
                            row = data2[i];
                            x2.push( row['time'] );
                            y21.push( row['erupt_rate'] );
                        }
                        makePlotly(x1, y11, y12, x2, y21);
                    });
                }); 
                
                function makePlotly(x1, y11, y12, x2, y21){
                    var plotDiv = document.getElementById("plot");
                    var trace1 = {
                        x: x1,
                        y: y11,
                        mode: 'lines',
                        name: 'ICE5G'
                    };
                    var trace2 = {
                        x: x1,
                        y: y12,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: '10 mm/yr'
                    };
                    var trace3 = {
                        x: x2,
                        y: y21,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: '20 mm/yr'
                    };
                    var data = [trace1, trace2, trace3];
                    var layout = {
                        grid: {rows: 2, columns: 1, pattern: 'independent'},
                        title: {text:'Model response to step change'},
                        xaxis1: {range: [0, 120]},
                        yaxis1: {title: {text: 'Ice Thickness (km)'}, range: [0, 2.5]},
                        xaxis2: {title: {text: 'Time (kyrs)'}, range: [0, 120]},
                        yaxis2: {title: {text: 'Eruption rate (km/Myr)'}}
                    };
                    
                    Plotly.newPlot('120ka-erupt', data, layout).then(Reveal.layout);
                };              
            });
        </script>
        
        <!-- 120 ka ICE5G CO2 flux -->
        
        <script>
            Reveal.addEventListener('120ka-CO2-is-visible', function() {
                Plotly.d3.csv("data/model_M1.csv", function(error1, data1) {
                    Plotly.d3.csv("data/model_M1b.csv", function(error2, data2) { 
                        var x1 = [], y11 = [], y12 = [], x2 = [], y21 = [];

                        for (var i=0; i<data1.length; i++) {
                            row = data1[i];
                            x1.push( row['time'] );
                            y11.push( row['ice_sheet'] );
                            y12.push( row['CO2_flux'] );
                        }
                        for (var i=0; i<data2.length; i++) {
                            row = data2[i];
                            x2.push( row['time'] );
                            y21.push( row['CO2_flux'] );
                        }
                        makePlotly(x1, y11, y12, x2, y21);
                    });
                }); 
                
                function makePlotly(x1, y11, y12, x2, y21){
                    var plotDiv = document.getElementById("plot");
                    var trace1 = {
                        x: x1,
                        y: y11,
                        mode: 'lines',
                        name: 'ICE5G'
                    };
                    var trace2 = {
                        x: x1,
                        y: y12,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: '10 mm/yr'
                    };
                    var trace3 = {
                        x: x2,
                        y: y21,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: '20 mm/yr'
                    };
                    var data = [trace1, trace2, trace3];
                    var layout = {
                        grid: {rows: 2, columns: 1, pattern: 'independent'},
                        title: {text:'Model response to step change'},
                        xaxis1: {range: [0, 120]},
                        yaxis1: {title: {text: 'Ice Thickness (km)'}, range: [0, 2.5]},
                        xaxis2: {title: {text: 'Time (kyrs)'}, range: [0, 120]},
                        yaxis2: {title: {text: 'CO2 flux (Mt/yr)'}, range: [0, 40]}
                    };
                    
                    Plotly.newPlot('120ka-CO2', data, layout).then(Reveal.layout);
                };              
            });
        </script>
        
        <!-- 40 ka ICE5G and PC2 eruption rates -->
        
        <script>
            Reveal.addEventListener('40ka-erupt-is-visible', function() {
                Plotly.d3.csv("data/model_M1b.csv", function(error1, data1) {
                    Plotly.d3.csv("data/model_M2.csv", function(error2, data2) { 
                        var x1 = [], y11 = [], y12 = [], x2 = [], y21 = [], y22 = [];

                        for (var i=0; i<data1.length; i++) {
                            row = data1[i];
                            x1.push( row['time'] );
                            y11.push( row['ice_sheet'] );
                            y12.push( row['erupt_rate'] );
                        }
                        for (var i=0; i<data2.length; i++) {
                            row = data2[i];
                            x2.push( row['time'] );
                            y21.push( row['ice_sheet'] );
                            y22.push( row['erupt_rate'] );
                        }
                        makePlotly(x1, y11, y12, x2, y21, y22);
                    });
                }); 
                
                function makePlotly(x1, y11, y12, x2, y21, y22){
                    var plotDiv = document.getElementById("plot");
                    var trace1 = {
                        x: x1,
                        y: y11,
                        mode: 'lines',
                        name: 'ICE5G'
                    };
                    var trace2 = {
                        x: x2,
                        y: y21,
                        mode: 'lines',
                        name: 'PC2'
                    };
                    var trace3 = {
                        x: x1,
                        y: y12,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'eruption ICE5G'
                    };
                    var trace4 = {
                        x: x2,
                        y: y22,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'eruption PC2'
                    };
                    var data = [trace1, trace2, trace3, trace4];
                    var layout = {
                        grid: {rows: 2, columns: 1, pattern: 'independent'},
                        title: {text:'Model response to step change'},
                        xaxis1: {range: [0, 40]},
                        yaxis1: {title: {text: 'Ice Thickness (km)'}, range: [0, 2.5]},
                        xaxis2: {title: {text: 'Time (kyrs)'}, range: [0, 40]},
                        yaxis2: {title: {text: 'Eruption rate (km/Myr)'}}
                    };
                    
                    Plotly.newPlot('40ka-erupt', data, layout).then(Reveal.layout);
                };              
            });
        </script>
        
        <!-- 40 ka ICE5G and PC2 Nb -->
        
        <script>
            Reveal.addEventListener('40ka-Nb-is-visible', function() {
                Plotly.d3.csv("data/model_M1b.csv", function(error1, data1) {
                    Plotly.d3.csv("data/model_M2.csv", function(error2, data2) { 
                        Plotly.d3.csv("data/Nb-binned.csv", function(error3, data3) {
                            var x1 = [], y11 = [], y12 = [];
                            var x2 = [], y21 = [], y22 = [];
                            var x3 = [], y31 = [], y32 = [];

                            for (var i=0; i<data1.length; i++) {
                                row = data1[i];
                                x1.push( row['time'] );
                                y11.push( row['erupt_rate'] );
                                y12.push( row['Nb'] );
                            }
                            for (var i=0; i<data2.length; i++) {
                                row = data2[i];
                                x2.push( row['time'] );
                                y21.push( row['erupt_rate'] );
                                y22.push( row['Nb'] );
                            }
                            for (var i=0; i<data3.length; i++) {
                                row = data3[i];
                                x3.push( row['time'] );
                                y31.push( row['Nb'] );
                                y32.push( row['Nbstd'] );
                            }
                            makePlotly(x1, y11, y12, x2, y21, y22, x3, y31, y32);
                        });
                    });
                });
                
                function makePlotly(x1, y11, y12, x2, y21, y22, x3, y31, y32){
                    var plotDiv = document.getElementById("plot");
                    var trace1 = {
                        x: x1,
                        y: y11,
                        mode: 'lines',
                        name: 'eruption ICE5G'
                    };
                    var trace2 = {
                        x: x2,
                        y: y21,
                        mode: 'lines',
                        name: 'eruption PC2'
                    };
                    var trace3 = {
                        x: x1,
                        y: y12,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'Nb ICE5G'
                    };
                    var trace4 = {
                        x: x2,
                        y: y22,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'Nb PC2'
                    };
                    var trace5 = {
                        x: x3,
                        y: y31,
                        error_y: {type: 'data',
                                  array: y32,
                                  visible: true
                                 },
                        xaxis: 'x2',
                        yaxis: 'y2',
                        type: 'scatter',
                        mode: 'markers',
                        name: 'Nb PC2'
                    };
                    var data = [trace1, trace2, trace3, trace4, trace5];
                    var layout = {
                        grid: {rows: 2, columns: 1, pattern: 'independent'},
                        title: {text:'Model response to step change'},
                        xaxis1: {range: [0, 40]},
                        yaxis1: {title: {text: 'Eruption rate (km/Myr)'}},
                        xaxis2: {title: {text: 'Time (kyrs)'}, range: [0, 40]},
                        yaxis2: {title: {text: 'Nb (ppm)'}}
                    };
                    
                    Plotly.newPlot('Nb-erupt', data, layout).then(Reveal.layout);
                };              
            });
        </script>
        
        <!-- 40 ka ICE5G and PC2 CO2 -->
        
        <script>
            Reveal.addEventListener('40ka-CO2-is-visible', function() {
                Plotly.d3.csv("data/model_M1b.csv", function(error1, data1) {
                    Plotly.d3.csv("data/model_M2.csv", function(error2, data2) { 
                        var x1 = [], y11 = [], y12 = [], x2 = [], y21 = [], y22 = [];

                        for (var i=0; i<data1.length; i++) {
                            row = data1[i];
                            x1.push( row['time'] );
                            y11.push( row['erupt_rate'] );
                            y12.push( row['CO2_flux'] );
                        }
                        for (var i=0; i<data2.length; i++) {
                            row = data2[i];
                            x2.push( row['time'] );
                            y21.push( row['erupt_rate'] );
                            y22.push( row['CO2_flux'] );
                        }
                        makePlotly(x1, y11, y12, x2, y21, y22);
                    });
                }); 
                
                function makePlotly(x1, y11, y12, x2, y21, y22){
                    var plotDiv = document.getElementById("plot");
                    var trace1 = {
                        x: x1,
                        y: y11,
                        mode: 'lines',
                        name: 'eruption ICE5G'
                    };
                    var trace2 = {
                        x: x2,
                        y: y21,
                        mode: 'lines',
                        name: 'eruption PC2'
                    };
                    var trace3 = {
                        x: x1,
                        y: y12,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'CO2 ICE5G'
                    };
                    var trace4 = {
                        x: x2,
                        y: y22,
                        xaxis: 'x2',
                        yaxis: 'y2',
                        mode: 'lines',
                        name: 'CO2 PC2'
                    };
                    var data = [trace1, trace2, trace3, trace4];
                    var layout = {
                        grid: {rows: 2, columns: 1, pattern: 'independent'},
                        title: {text:'Model response to step change'},
                        xaxis1: {range: [0, 40]},
                        yaxis1: {title: {text: 'Eruption rate (km/Myr)'}},
                        xaxis2: {title: {text: 'Time (kyrs)'}, range: [0, 40]},
                        yaxis2: {title: {text: 'CO2 flux (Mt:yr)'}}
                    };
                    
                    Plotly.newPlot('CO2-erupt', data, layout).then(Reveal.layout);
                };              
            });
        </script>
	</body>
</html>
